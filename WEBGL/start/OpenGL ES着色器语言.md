# OpenGL ES着色器语言（GLSL ES）

GLSL ES (OpenGL Shading Language for Embedded Systems)是OpenGL ES平台上使用的着色器语言。它是一种高级着色器语言，用于编写着色器程序，用于控制OpenGL ES渲染管线中的图形渲染和图像处理过程。

GLSL ES可以在移动设备和嵌入式设备等资源受限的环境中运行。它支持着色器的高度可编程性，允许开发人员自定义渲染管线，以实现更高质量的渲染效果和更好的图形性能。

## 注释

与javascript一致

## 数据值类型
GLSL支持两种数据值类型
- 数据值类型： 整形和浮点型
- 布尔值类型： true false
不支持字符串类型

## 变量
- 只包含a-z A-Z 0-9 和下划线_
- 变量名的首字母不能是数字
- 不是是关键字以及保留字段

## 强类型
<类型> <变量名>

## 基本类型
|类型|描述|
|---|---|
|float|单精度浮点型|
|int|整形|
|bool|布尔型|

### 类型转换
|转换|函数|描述|
|---|---|---|
|转换为整型|int(float) / int(bool)|浮点数的小数部分去掉转换为整形, ture 1 false 0|
|转换为浮点型|float(int) / float(bool)|浮点数的小数部分去掉转换为整形, true 1.0 false 0.0|
|转换为布尔值|bool(int) / bool(float)|0.0 false 其他true； 0 false 其他 true|

## 矢量与矩阵

|类别|GLSL ES 数据类型|描述|
|---|---|---|
|矢量|vec2 vec3 vec4</br> ivec2 ivec3 ivec4</br>bvec2 bvec3 bvec4|具有2，3，4个浮点数的元素矢量</br>具有2，3，4个整数的元素矢量</br>具有2，3，4个布尔值的元素矢量|
|矩阵|mat2 mat3 mat4|2 * 2， 3 * 3， 4 * 4的浮点数元素矩阵|

## 赋值与构造

赋值运算的=左右两边的类型必须一致。

### 矢量构造函数
```js
vec4 postion = vec4(1.0, 2.0, 3.0, 4.0)
vec3 v3 = vec3(1.0, 2.0, 3.0)
// 使用v3的前两个分量
vec2 v2 = vec2(v3) // （1.0， 2.0）
vec4 v4 = vec4(1.0) // (1.0, 1.0, 1.0, 1.0)
vec4 v4b = vec4(v2, v4) // (1.0, 2.0, 1.0, 1.0)
```

### 矩阵构造函数
矩阵中的元素按照列主序排列

```js
mat4 m4 = mat4(
    1.0, 2.0, 3.0, 4.0,
    5.0, 6.0, 7.0, 8.0,
    9.0, 10.0, 11.0, 12.0,
    13.0, 14.0, 15.0 16.0
)
```
矩阵如下：
$\begin{bmatrix}
 1.0, 5.0, 9.0, 13.0 \\
 2.0, 6.0, 10.0, 14.0 \\
 3.0, 7.0, 11.0, 15.0 \\
 4.0, 8.0, 12.0, 16.0 \\
 \end{bmatrix} $

 向矩阵中传入一个或多个矢量，按照列主序使用矢量里的元素值来构造矩阵

 ```js
 vec2 v2_1 = (1.0, 3.0)
 vec2 v2_2 = (2.0, 4.0)

 mat2 m2_1 = mat2(v2_1, v2_2)

 vec4 v4 = (1.0, 3.0, 2.0, 4.0)
 mat2 m2_2 = mat2(v4)
 ```
 上述形成的矩阵

 $\begin{bmatrix}
 1.0, 2.0, \\
 3.0, 4.0, \\
 \end{bmatrix} $

向矩阵构造函数中传入单个值，这样将生成一个对角线上元素都是该数值，其他元素为0的矩阵。

```js
mat4 m4 = mat4(1.0)
```
$\begin{bmatrix}
 1.0, 0.0, 0.0, 0.0 \\
 0.0, 1.0, 0.0, 0.0 \\
 0.0, 0.0, 1.0, 0.0 \\
 0.0, 0.0, 0.0, 1.0 \\
 \end{bmatrix} $

### 访问元素

访问运算符是 . 或者 []

#### 点运算符

|类别|描述|
|---|---|
|x,y,z,w|获取顶点坐标|
|r,g,b,a|获取颜色分量|
|s,t,p,q|获取纹理分量|

```js
vec3 v3 = (1.0, 2.0, 3.0)

float f 

f = v3.x // 1.0
f = v3.y // 2.0
f = v3.z // 3.0

f = v3.r // 1.0
f = v3.g // 2.0
f = v3.b // 3.0

f = v3.a 或 f = v3.w 报错
```

混合：从矢量中抽取多个分量的过程

```js
vec2 v2 
v2 = v3.xy
// 可以省略任意分量
v2 = v3.yw
v2 = v3.yy

vec3 v3
v3 = v3.zyx
```

也可以赋值

```js
vec4 position = vec4(1.0, 2.0, 3.0, 4.0)
position.xw = vec2(5.0, 6.0)
// position (5.0,2.0,3.0,6.0)
```

#### []运算符

和js一样0访问矩阵第一列，1可以访问矩阵第二列，2可以访问矩阵第三列

$\begin{bmatrix}
 1.0, 5.0, 9.0, 13.0 \\
 2.0, 6.0, 10.0, 14.0 \\
 3.0, 7.0, 11.0, 15.0 \\
 4.0, 8.0, 12.0, 16.0 \\
 \end{bmatrix} $

```js
mat4 m4 = mat4(
    1.0, 2.0, 3.0, 4.0,
    5.0, 6.0, 7.0, 8.0,
    9.0, 10.0, 11.0, 12.0,
    13.0, 14.0, 15.0 16.0
)

// 矩阵的第一列
vec4 v4 = m4[0] // (1.0, 2.0, 3.0, 4.0)
// 第二列的第三行
float m23 = m4[1][2] // 7.0
// 第三列的第二个元素
folat m32 = m4[2].y // 10.0
```
[]中必须是常量所索引值，定义如下：
- 整形字面量（0 或 1）
- 用const修饰全局变量或局部变量
- 循环索引

```js
const int index = 0
vec4 v4 = m4[index]
vec4 v4 = m4[index + 1]
```

### 运算

#### 矢量与浮点数的运算

- 加法
```js
vec3 v3a = vec2(1.0, 2.0, 3.0)
float f = 1.0
vec3 v3b = v3a + f // (2.0, 3.0, 4.0)
```

- 乘法
```js
vec3 v3a = vec2(1.0, 2.0, 3.0)
float f = 1.0
vec3 v3b = v3a * f // (1.0, 2.0, 3.0)
```

#### 矢量运算

```js
v3c = v3a + v3b

/**
v3a.x + v3b.x
v3a.y + v3b.y
v3a.z + v3b.z
 */
```

#### 矩阵与浮点数的运算

```js
// 相当于矩阵的每一个元素都乘以f
m3b = m3a * f
```

#### 矩阵右乘矢量

```js
mat3 m3a = mat3(
    1.0, 4.0, 7.0,
    2.0, 5.0, 8.0
    3.0, 6.0, 9.0
)
vec3 v3a = vec3(1.0, 2.0, 3.0)
vec3 v3b = m3a * v3a
```
$\begin{bmatrix}
 1.0, 2.0, 3.0 \\
 4.0, 5.0, 6.0 \\
 7.0, 8.0, 9.0 \\
 \end{bmatrix} * \begin{bmatrix}
  1.0 \\
 2.0 \\
 3.0 \\
 \end{bmatrix} = \begin{bmatrix}
 14.0 \\
 32.0 \\
 50.0 \\
 \end{bmatrix}$

#### 矩阵右乘矢量


```js
mat3 m3a = mat3(
    1.0, 4.0, 7.0,
    2.0, 5.0, 8.0
    3.0, 6.0, 9.0
)
vec3 v3a = vec3(1.0, 2.0, 3.0)
vec3 v3b = v3a * m3a
```
$\begin{bmatrix}
  1.0, 2.0, 3.0 \\
 \end{bmatrix} * \begin{bmatrix}
 1.0, 2.0, 3.0 \\
 4.0, 5.0, 6.0 \\
 7.0, 8.0, 9.0 \\
 \end{bmatrix}  = \begin{bmatrix}
 30.0 \\
 36.0 \\
 42.0 \\
 \end{bmatrix}$

 #### 矩阵与矩阵相乘

见矩阵乘法

