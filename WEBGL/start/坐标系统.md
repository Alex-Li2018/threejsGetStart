# 坐标系统

在不同的坐标系统中，每个点所表达的含义与作用皆不相同，而坐标系统又与空间紧密结合。在3D系统里常见的空间有Local space / World space / View space / Clip space，每一个空间都有自己对应的坐标系统，同时从一个空间或者坐标系统转换到另一个空间或坐标系统，常用的方式是转换矩阵transformation matrices。接下来我们将仔细谈一谈这些内容。

![coordinate_systems.png](./imgs/coordinate_systems.png)

## space 空间

### Local space 局部空间
局部空间对应的坐标是局部的坐标（Local coordinates），坐标系以物体的中心为坐标原点，物体的旋转、平移等操作都是围绕局部坐标系进行的，这时，当物体模型进行旋转或平移等操作时，局部坐标系也执行相应的旋转或平移操作。


### World space 世界空间
局部空间通过模型矩阵转换为世界空间。

如果还以局部坐标来描述两个不一样的物体，明显是不行的。不能区分出谁是谁。而世界空间下的世界坐标系是能区分出多个物体对应的位置。世界坐标系是系统的绝对坐标系，画面上所有点的坐标都是以该坐标系的原点来确定各自的位置的。

### View space 观察空间
世界空间通过视图矩阵进入观察空间。

视野空间也是人们常说的相机空间，视野空间是将世间空间里的坐标点转换到视野里的坐标点的结果。因此，视图空间是从相机的视点看到的空间。这通常通过平移和旋转的组合来平移/旋转场景，以便将某些项目转换到相机的前面。

### Clip space 裁切空间
观察空间通过投影矩阵进入裁剪空间。裁剪空间中能够通过透视来模拟出真实世界的物体远近，还会将位于裁剪空间之外的其他物体给裁减掉（即不显示）。

裁剪空间的目标是能够方便地对渲染图元进行裁剪：完全位于这块空间内部的图元将会被保留，完全位于这块空间外部的图元将会被剔除，而与这块空间边界相交的图元就会被裁剪。那么，这块空间是如何决定的呢？答案是由视锥体(view frustum)来决定。

视锥体指的是空间中的一块区域，这块区域决定了摄像机可以看到的空间。视锥体由六个平面包围而成，这些平面也被称为裁剪平面(clip planes)。视锥体有两种类型，这涉及两种投影类型：一种是正交投影(orthographic projection)，一种是透视投影(perspective projection)。

在视锥体的6块裁剪平面中，有两块裁剪平面比较特殊，它们分别被称为近裁剪平面(near clip plane)和远裁剪平面(far clip plane)。它们决定了摄像机可以看到的深度范围。

## MVP矩阵

### model matrix 模型矩阵

[模型矩阵推导](/math/%E7%9F%A9%E9%98%B5.md)

$$M = \begin{bmatrix}
 1, 0, 0, Tx \\
 0, 1, 0, Ty \\
 0, 0, 1, Tz \\
 0, 0, 0, 1 \\
 \end{bmatrix} 
\begin{bmatrix}
 \cos\beta, -\sin\beta, 0, 0 \\
 \sin\beta, \cos\beta, 0, 0 \\
 0, 0, 1, 1 \\
 0, 0, 0, 1 \\
\end{bmatrix} 
\begin{bmatrix}
 s_x, 0, 0, 0\\
 0, s_y, 0, 0 \\
 0, 0, s_z, 0 \\
 0, 0, 0, 1 \\
 \end{bmatrix}
$$

### view matrix 视图矩阵
是改变 OpenGL 摄像机的位置。将空间坐标系的原点变换到摄像机的位置为新的原点。

已知：相机的坐标系，还有相机在世界空间下的坐标，就可以求出ViewMatrix，下面进行具体推导。

[视图矩阵推导](/math/%E8%A7%86%E5%9B%BE%E7%9F%A9%E9%98%B5.md)


### projection matrix 投影矩阵



